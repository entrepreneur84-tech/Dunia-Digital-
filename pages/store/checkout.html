<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout - Dunia Digital Shop</title>
  <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
  <div class="container">
    <h1>ðŸ›’ Checkout Produk</h1>

    <div id="checkoutContainer">
      <!-- Produk yang dipilih akan muncul di sini otomatis -->
    </div>

    <div id="totalContainer" style="margin-top:20px;font-size:18px;font-weight:bold;">
      Total: <span id="totalAmount">0</span>
    </div>

    <button id="confirmPurchase" class="btn" style="margin-top:20px;">Konfirmasi Pembelian</button>

    <footer style="margin-top:40px;">
      Â© 2026 Dunia Digital Shop â€” Toko Ebook Premium Spiritual
    </footer>
  </div>

  <script src="../assets/js/app.js"></script>
  <script src="../assets/js/analytics.js"></script>
  <script>
    // Ambil data produk dari localStorage
    const checkoutContainer = document.getElementById('checkoutContainer');
    const totalAmountSpan = document.getElementById('totalAmount');
    let cart = JSON.parse(localStorage.getItem('selectedEbook')) || [];
    let total = 0;

    if(cart.length === 0){
      checkoutContainer.innerHTML = '<p>Belum ada produk yang dipilih. <a href="../pages/ebooks.html">Kembali ke katalog</a></p>';
    } else {
      cart.forEach(item => {
        // Default harga bisa ditambahkan di item.harga
        const price = item.harga || 99000; // default 99.000
        total += price;

        const card = document.createElement('div');
        card.className = 'card';
        card.style.marginBottom = '20px';
        card.innerHTML = `
          <img src="../assets/img/${item.img}" alt="${item.title}" style="width:150px;float:left;margin-right:15px;">
          <div class="card-body" style="overflow:hidden;">
            <div class="title">${item.title}</div>
            <div class="desc">${item.desc}</div>
            <div class="price">Harga: Rp ${price.toLocaleString()}</div>
          </div>
        `;
        checkoutContainer.appendChild(card);
      });

      totalAmountSpan.textContent = 'Rp ' + total.toLocaleString();
    }

    // Tombol konfirmasi
    document.getElementById('confirmPurchase').addEventListener('click', () => {
      if(cart.length === 0){
        alert('Belum ada produk yang dipilih.');
        return;
      }

      // Simpan order ke localStorage atau panggil API server
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      orders.push({
        items: cart,
        total: total,
        date: new Date().toISOString()
      });
      localStorage.setItem('orders', JSON.stringify(orders));

      // Kosongkan cart
      localStorage.removeItem('selectedEbook');

      // Redirect ke halaman sukses
      window.location.href = '../pages/success.html';
    });
    <script>
// Ambil parameter produk dari URL
const urlParams = new URLSearchParams(window.location.search);
const product = urlParams.get('product') || 'Produk Tidak Diketahui';

// Isi nama produk di halaman
document.getElementById("productName").innerText = product;

// Handle submit form
document.getElementById("checkoutForm").addEventListener("submit", function(e){
  e.preventDefault();

  const nama  = document.getElementById("nama").value;
  const email = document.getElementById("email").value;

  // Ambil data order lama
  let orders = JSON.parse(localStorage.getItem("orders") || "[]");

  // Tambahkan order baru
  orders.push({
    nama: nama,
    email: email,
    produk: product,
    tanggal: new Date().toLocaleString()
  });

  // Simpan ke localStorage
  localStorage.setItem("orders", JSON.stringify(orders));

  // Redirect ke halaman sukses
  window.location.href = "../success.html?product=" + encodeURIComponent(product);
});
</script>
  </script><script>
document.getElementById("checkoutForm").addEventListener("submit", async function(e){
    e.preventDefault();

    const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        product: "ksatria-spiritual"
    };

    const response = await fetch("/api/checkout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    });

    const result = await response.json();

    if(result.success){
        window.location.href = "/pages/success.html";
    } else {
        alert("Terjadi kesalahan.");
    }
});
  </script> <h2>Checkout Ebook</h2>

<form id="checkoutForm">
  <input type="text" id="name" placeholder="Nama Lengkap" required><br><br>
  <input type="email" id="email" placeholder="Email Aktif" required><br><br>
  <button type="submit">Konfirmasi Pesanan</button>
</form>

<script>
document.getElementById("checkoutForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const product = new URLSearchParams(window.location.search).get("product");

  const response = await fetch("/api/checkout", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      name: document.getElementById("name").value,
      email: document.getElementById("email").value,
      product: product
    })
  });

  const result = await response.json();

  if(result.success){
    window.location.href = "success.html?order=" + result.orderId;
  }
});
</script>
</body>
</html>
